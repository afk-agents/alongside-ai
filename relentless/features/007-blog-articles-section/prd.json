{
  "project": "Alongside AI",
  "branchName": "007-blog-articles-section",
  "description": "Blog/Articles Section - Article listing page with filtering. Individual article pages with rich formatting. Author attribution. Related content links. Substack sync (manual or RSS initially).",
  "userStories": [
    {
      "id": "US-001",
      "title": "Core Article Queries - List and Featured",
      "description": "As a frontend developer, I need Convex queries to fetch published articles with pagination and featured articles, so that the blog listing page can display article data.",
      "acceptanceCriteria": [
        "Create `convex/articles.ts` file with imports and utilities",
        "Implement `articles.list` query with args: limit (optional, default 10), cursor (optional), tagId (optional)",
        "Query articles using `by_publishedAt` index, order descending",
        "Apply cursor-based pagination (skip articles newer than cursor timestamp)",
        "Filter by tagId if provided (post-query filter since tags is an array)",
        "Join author profile (fetch profile by authorId, handle null if deleted)",
        "Join tags (fetch each tag by id, filter out deleted)",
        "Return: articles array, nextCursor, hasMore",
        "Implement `articles.listFeatured` query with args: limit (optional, default 3)",
        "Query using `by_isFeatured_and_publishedAt` index",
        "Filter where isFeatured === true",
        "Order by publishedAt descending",
        "Join author profile (displayName, slug only)",
        "Return array of featured articles",
        "Both queries have proper TypeScript return type validators",
        "Queries handle empty results gracefully",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": true
    },
    {
      "id": "US-002",
      "title": "Article Detail Query - Get By Slug",
      "description": "As a frontend developer, I need a Convex query to fetch a single article by its URL slug with full details, so that individual article pages can render complete content.",
      "acceptanceCriteria": [
        "Implement `articles.getBySlug` query in convex/articles.ts",
        "Accept slug string argument",
        "Query using `by_slug` index for O(1) lookup",
        "Return null if article not found",
        "Join author profile (full profile fields: displayName, slug, photoUrl, bio)",
        "Join tags (id, name, slug for clickable tag links)",
        "Return complete article object with content",
        "Proper TypeScript return type validator",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": true
    },
    {
      "id": "US-003",
      "title": "Related Articles Query",
      "description": "As a visitor reading an article, I want to see related articles based on shared tags, so that I can continue exploring relevant content.",
      "acceptanceCriteria": [
        "Implement `articles.getRelated` query in convex/articles.ts",
        "Accept articleId and optional limit (default 3)",
        "Fetch current article to get its tags array",
        "Query all articles (recent, limit to 50 for performance)",
        "Filter: exclude current article, require at least one shared tag",
        "Calculate sharedTagCount for each candidate",
        "Sort by sharedTagCount desc, then publishedAt desc",
        "If no results, query articles by same authorId",
        "Return top N with title, slug, excerpt, publishedAt, sharedTagCount",
        "Returns empty array if no related content exists",
        "Proper TypeScript return type validator",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 15,
      "passes": true
    },
    {
      "id": "US-004",
      "title": "Admin Article CRUD Mutations",
      "description": "As an admin, I need mutations to create, update, and delete articles, so that I can manage blog content through the admin interface.",
      "acceptanceCriteria": [
        "Add slug validation utilities: validateSlug function (reuse pattern from tags.ts), generateSlug function to create slug from title",
        "Implement `articles.listAdmin` query requiring admin role",
        "Query all articles sorted by publishedAt desc, join author displayName",
        "Return minimal fields for table: id, title, slug, publishedAt, isFeatured, authorName, tagCount",
        "Implement `articles.get` query for admin (single article for editing)",
        "Implement `articles.create` mutation with args: title, slug, content, authorId, publishedAt, excerpt, tags, substackUrl, isFeatured",
        "Validate slug format and uniqueness",
        "Verify authorId references existing published profile",
        "Verify all tagIds exist (if provided)",
        "Auto-generate excerpt from first 160 chars of content if not provided",
        "Implement `articles.update` mutation with id and all optional fields",
        "Verify article exists, validate slug uniqueness if changed",
        "Implement `articles.remove` mutation with id",
        "All mutations require admin role",
        "All mutations have proper return type validators",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 8,
      "passes": true
    },
    {
      "id": "US-005",
      "title": "Install Markdown Rendering Dependencies",
      "description": "As a developer, I need to install the required npm packages for Markdown rendering with proper sanitization, so that article content can be rendered safely.",
      "acceptanceCriteria": [
        "Run: `bun add react-markdown remark-gfm rehype-sanitize rehype-highlight`",
        "Verify installation successful with no peer dependency warnings",
        "Verify packages are compatible with React 19 and Next.js 16",
        "Run `bun run build` to ensure no build errors",
        "Test basic import in a component file",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true
    },
    {
      "id": "US-006",
      "title": "ArticleContent Component - Markdown Renderer",
      "description": "As a visitor reading an article, I want the Markdown content to render with proper formatting including headings, lists, code blocks, and images, so that articles are readable and visually appealing.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleContent.tsx`",
        "Import ReactMarkdown, remarkGfm, rehypeSanitize, rehypeHighlight",
        "Accept content prop (string)",
        "Configure remark and rehype plugins",
        "Create custom component mappings: Headings with slugified id for anchor links, Links with external detection and target/rel, Code with syntax highlighting, Images with responsive container",
        "Use Tailwind prose classes for typography",
        "Configure dark mode prose variants",
        "Style code blocks with background and padding",
        "Add highlight.js theme CSS (or equivalent)",
        "Create `components/articles/index.ts` barrel export file",
        "HTML is sanitized to prevent XSS attacks",
        "GitHub-flavored markdown supported (tables, strikethrough, task lists)",
        "External links open in new tab with rel=\"noopener noreferrer\"",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 4,
      "passes": true
    },
    {
      "id": "US-007",
      "title": "ArticleMeta Component - Author Attribution",
      "description": "As a visitor, I want to see who wrote an article and when it was published, so that I can understand the source and timeliness of the content.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleMeta.tsx`",
        "Accept props: author (object or null), publishedAt (number), size (sm/md)",
        "Import ProfilePhoto from profiles components",
        "Display author photo using ProfilePhoto component",
        "Display author name with Link to /profiles/[slug]",
        "Handle null author with \"Unknown Author\" text",
        "Format publishedAt timestamp to readable date (\"Month Day, Year\")",
        "Apply size-based styling (sm for cards, md for article page)",
        "Accessible with proper alt text and aria labels",
        "Add date formatting utility function using Intl.DateTimeFormat",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 5,
      "passes": true
    },
    {
      "id": "US-008",
      "title": "ArticleCard Component - Listing Display",
      "description": "As a visitor browsing the blog, I want to see article previews in a compact card format, so that I can quickly scan and select articles of interest.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleCard.tsx`",
        "Accept article prop with: title, slug, excerpt, publishedAt, author, tags",
        "Accept variant prop: \"default\" | \"featured\"",
        "Import ArticleMeta component for author/date",
        "Import TagBadge from existing tag components",
        "Wrap card in Link to /blog/[slug]",
        "Apply line-clamp for excerpt truncation (2-3 lines)",
        "Add hover effects (shadow, scale, or border)",
        "Style featured variant differently (larger, highlighted)",
        "Responsive design works on all screen sizes",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 6,
      "passes": true
    },
    {
      "id": "US-009",
      "title": "ArticleList Component with Pagination",
      "description": "As a visitor on the blog page, I want to see a list of articles with the ability to load more, so that I can browse all available content without initial page load delays.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleList.tsx`",
        "Accept initialTagId prop (optional)",
        "Use useQuery with api.articles.list",
        "Track pagination state: cursor, allArticles array",
        "Render loading skeleton initially",
        "Map articles to ArticleCard components",
        "Display \"Load More\" button if hasMore",
        "Handle button click: fetch next page with cursor",
        "Append new articles to existing list",
        "Show empty state if no articles",
        "Create ArticleListSkeleton component with placeholder cards and animate-pulse",
        "Supports tag filter passed from parent",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 7,
      "passes": true
    },
    {
      "id": "US-010",
      "title": "ArticleFilters Component - Tag Filtering",
      "description": "As a visitor, I want to filter articles by tag, so that I can find content on specific topics.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleFilters.tsx`",
        "Accept props: selectedTagId, onTagSelect callback",
        "Use useQuery with api.tags.list to fetch tags",
        "Display tags with contentCount > 0 for articles",
        "Render \"All Articles\" button first",
        "Render tag chips in horizontal scrollable container",
        "Apply selected styling to active tag",
        "Call onTagSelect with tagId on click",
        "Call onTagSelect with undefined for \"All\"",
        "Horizontal scrollable on mobile if many tags",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 16,
      "passes": true
    },
    {
      "id": "US-011",
      "title": "FeaturedArticles Component",
      "description": "As a visitor on the blog page, I want to see featured articles prominently displayed, so that I can discover highlighted content.",
      "acceptanceCriteria": [
        "Create `components/articles/FeaturedArticles.tsx`",
        "Accept articles prop (from parent or fetch itself)",
        "Render section with \"Featured\" heading",
        "Display ArticleCard with variant=\"featured\"",
        "Use different grid layout (e.g., larger first item)",
        "Return null if articles array is empty",
        "Maximum 3 featured articles displayed",
        "Distinct visual treatment (different layout, larger cards, or background)",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 18,
      "passes": true
    },
    {
      "id": "US-012",
      "title": "Blog Listing Page",
      "description": "As a visitor, I want to browse all published articles on a dedicated blog page, so that I can discover content.",
      "acceptanceCriteria": [
        "Create `app/blog/page.tsx`",
        "Mark as client component (\"use client\")",
        "Add page header with title and description",
        "Fetch featured articles with useQuery",
        "Manage tag filter state with useState",
        "Conditionally render FeaturedArticles (when no filter)",
        "Render ArticleFilters with state and callback",
        "Render ArticleList with tag filter",
        "Add proper page structure and spacing",
        "Page has proper metadata (title, description)",
        "Page is responsive and well-styled",
        "Typecheck passes",
        "Verify in browser: page loads, filters work, pagination works"
      ],
      "priority": 9,
      "passes": true
    },
    {
      "id": "US-013",
      "title": "Individual Article Page",
      "description": "As a visitor, I want to read a full article on its own page, so that I can consume the complete content with proper formatting.",
      "acceptanceCriteria": [
        "Create `app/blog/[slug]/page.tsx`",
        "Mark as client component",
        "Extract slug from params (Next.js 16: params is Promise)",
        "Fetch article with useQuery and slug",
        "Show loading skeleton while undefined",
        "Call notFound() if article is null",
        "Render ArticleHeader with title, meta, tags",
        "Render ArticleContent with content",
        "Render Substack link if substackUrl exists",
        "Create `components/articles/ArticleHeader.tsx` with title as h1, ArticleMeta, tag links",
        "Create `app/blog/[slug]/not-found.tsx` with link back to /blog",
        "Page has proper metadata (title, description)",
        "Typecheck passes",
        "Verify in browser: article loads, 404 works, formatting correct"
      ],
      "priority": 10,
      "passes": true
    },
    {
      "id": "US-014",
      "title": "RelatedArticles Component",
      "description": "As a visitor who finished reading an article, I want to see related articles, so that I can continue exploring similar content.",
      "acceptanceCriteria": [
        "Create `components/articles/RelatedArticles.tsx`",
        "Accept articleId prop",
        "Fetch related articles with useQuery (api.articles.getRelated)",
        "Return null if loading or empty results",
        "Render section with heading (\"Related Articles\" or \"Keep Reading\")",
        "Display compact article cards (simplified ArticleCard or custom)",
        "Link each to /blog/[slug]",
        "Displays up to 3 related articles",
        "Section hidden when no related articles exist",
        "Integrate into article page after article content",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 17,
      "passes": true
    },
    {
      "id": "US-015",
      "title": "Admin Article List Page",
      "description": "As an admin, I need a page to view all articles and access article management, so that I can oversee blog content.",
      "acceptanceCriteria": [
        "Create `app/admin/articles/page.tsx`",
        "Require admin authentication",
        "Fetch articles with api.articles.listAdmin",
        "Display in table with columns: Title, Author, Date, Featured, Actions",
        "Add \"Create New Article\" button linking to /admin/articles/new",
        "Add Edit link to /admin/articles/[id]/edit",
        "Add Delete button with confirmation",
        "Create `components/articles/ArticleTable.tsx` with table rendering",
        "Matches existing admin page styling",
        "Typecheck passes",
        "Verify in browser: table displays, actions work"
      ],
      "priority": 11,
      "passes": true
    },
    {
      "id": "US-016",
      "title": "Article Editor Component",
      "description": "As an admin, I need a form to create and edit articles with Markdown preview, so that I can write and publish blog content.",
      "acceptanceCriteria": [
        "Create `components/articles/ArticleEditor.tsx`",
        "Accept article prop (undefined for create, defined for edit)",
        "Accept onSuccess callback",
        "Form state for all fields: title, slug, content, excerpt, authorId, tags, publishedAt, isFeatured, substackUrl",
        "Auto-generate slug from title (with edit capability)",
        "Fetch profiles for author dropdown",
        "Fetch tags for multi-select",
        "Validate required fields",
        "Call create or update mutation on submit",
        "Display validation errors",
        "Show loading state during submission",
        "Create `components/articles/MarkdownPreview.tsx` using ArticleContent",
        "Create split editor layout: two-column editor | preview",
        "Live Markdown preview of content",
        "Collapsible preview on mobile",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 12,
      "passes": true
    },
    {
      "id": "US-017",
      "title": "Create Article Page",
      "description": "As an admin, I need a page to create new articles, so that I can add content to the blog.",
      "acceptanceCriteria": [
        "Create `app/admin/articles/new/page.tsx`",
        "Require admin authentication",
        "Render ArticleEditor with article=undefined",
        "Handle onSuccess: redirect to /admin/articles",
        "Add page header \"Create New Article\"",
        "Matches existing admin page styling",
        "Typecheck passes",
        "Verify in browser: editor loads, create works, redirect happens"
      ],
      "priority": 13,
      "passes": true
    },
    {
      "id": "US-018",
      "title": "Edit Article Page",
      "description": "As an admin, I need a page to edit existing articles, so that I can update and correct blog content.",
      "acceptanceCriteria": [
        "Create `app/admin/articles/[id]/edit/page.tsx`",
        "Require admin authentication",
        "Extract id from params",
        "Fetch article with api.articles.get",
        "Show loading while fetching",
        "Show 404 if not found",
        "Render ArticleEditor with fetched article",
        "Handle onSuccess: redirect to /admin/articles",
        "Create `app/admin/articles/[id]/edit/not-found.tsx` with link back to admin articles list",
        "Typecheck passes",
        "Verify in browser: editor loads with data, edit works, redirect happens"
      ],
      "priority": 14,
      "passes": true
    },
    {
      "id": "US-019",
      "title": "Install RSS Parser Dependency",
      "description": "As a developer, I need to install the RSS parsing package for Substack import functionality, so that the RSS action can be implemented.",
      "acceptanceCriteria": [
        "Run: `bun add rss-parser`",
        "Verify installation successful",
        "Test import in Convex action",
        "Package compatible with Convex actions (Node.js runtime)",
        "No dependency conflicts",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": true
    },
    {
      "id": "US-020",
      "title": "Substack RSS Parser Action",
      "description": "As an admin, I need to parse a Substack RSS feed URL to preview articles for import, so that I can migrate content from Substack.",
      "acceptanceCriteria": [
        "Implement `articles.parseRssFeed` action in convex/articles.ts",
        "Import rss-parser",
        "Require admin role",
        "Validate URL format (starts with http/https)",
        "Configure parser for Substack feeds (content:encoded field)",
        "Parse feed URL",
        "Handle errors (network, parsing)",
        "Add internal helper query getExistingSubstackUrls",
        "Check existing articles by substackUrl",
        "Return parsed items with alreadyImported flag",
        "Returns array with: title, content, publishedAt, substackUrl, excerpt",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 20,
      "passes": true
    },
    {
      "id": "US-021",
      "title": "RSS Import Mutation",
      "description": "As an admin, I need to import selected articles from a parsed RSS feed, so that I can bulk add Substack content to the blog.",
      "acceptanceCriteria": [
        "Implement `articles.importFromRss` mutation in convex/articles.ts",
        "Require admin role",
        "Accept: items array, authorId, optional tags array",
        "For each item: generate slug from title, check for existing substackUrl",
        "If new: insert article with all fields",
        "If exists: skip",
        "Track imported and skipped counts",
        "Return { imported, skipped }",
        "Creates articles with auto-generated slugs",
        "Assigns specified author to all articles",
        "Optionally applies tags to all articles",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 21,
      "passes": true
    },
    {
      "id": "US-022",
      "title": "RSS Importer UI Component",
      "description": "As an admin, I need a UI to input an RSS URL, preview articles, and select which ones to import, so that I can control the import process.",
      "acceptanceCriteria": [
        "Create `components/articles/RssImporter.tsx`",
        "URL input field with \"Fetch\" button",
        "URL input with validation",
        "Fetch button triggers parseRssFeed action",
        "Loading state while parsing",
        "Display parsed articles as checklist",
        "Preview list of articles with checkboxes",
        "Disable checkboxes for alreadyImported items with \"Already imported\" label",
        "Author dropdown for assignment (required)",
        "Tags multi-select (optional)",
        "\"Import Selected\" button triggers importFromRss",
        "Display results summary",
        "Success/error feedback after import",
        "Export from components/articles/index.ts",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 22,
      "passes": true
    },
    {
      "id": "US-023",
      "title": "RSS Import Admin Page",
      "description": "As an admin, I need a dedicated page for Substack import, so that I can access the import functionality.",
      "acceptanceCriteria": [
        "Create `app/admin/articles/import/page.tsx`",
        "Require admin authentication",
        "Add page header \"Import from Substack\"",
        "Render RssImporter component",
        "Add back link to /admin/articles",
        "Has navigation back to articles list",
        "Typecheck passes",
        "Verify in browser: import page loads, import flow works"
      ],
      "priority": 23,
      "passes": true
    }
  ]
}
