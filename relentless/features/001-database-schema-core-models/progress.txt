---
feature: Database Schema & Core Models
started: '2026-01-16T20:13:02.894Z'
last_updated: '2026-01-16T21:45:00.000Z'
stories_completed: 4
patterns: []
---
# Progress Log: Database Schema & Core Models

## 2026-01-16 - US-001: Profiles Table

**Implemented:**
- Defined `profiles` table in `convex/schema.ts` with all required fields
- Added `userId` field linking to auth users via `v.id("users")`
- Implemented role system with union validator: `admin`, `member`, `guest`
- Implemented profileStatus with union validator: `locked`, `unlocked`, `published`
- Added all optional fields: displayName, bio, photoUrl, socialLinks, workingOnNow, skills, location
- Created `socialLinks` nested object with linkedin, twitter, github, website (all optional)
- Added indexes: `by_userId`, `by_role`, `by_profileStatus`
- Removed placeholder `numbers` table and `myFunctions.ts`
- Fixed ESLint config to ignore `convex/_generated` files

**Files Changed:**
- `convex/schema.ts` - Replaced placeholder schema with profiles table
- `convex/myFunctions.ts` - Removed (was placeholder depending on numbers table)
- `eslint.config.mjs` - Added convex/_generated to ignores

**Quality Checks:**
- `bunx tsc --noEmit` - PASS (0 errors)
- `bun run lint` - PASS (0 warnings)

**Learnings:**
- The existing schema had a placeholder `numbers` table with associated `myFunctions.ts` that needed removal
- Generated Convex files in `convex/_generated` weren't ignored by ESLint, causing warnings
- authTables from @convex-dev/auth must be spread first in the schema definition

---

## 2026-01-16 - US-002: Tags Table

**Implemented:**
- Defined `tags` table in `convex/schema.ts` with required fields: name, slug
- Added optional `description` field
- Created indexes: `by_slug` (URL routing), `by_name` (lookup by name)
- Added documentation comments explaining table purpose

**Files Changed:**
- `convex/schema.ts` - Added tags table with indexes

**Quality Checks:**
- `bunx tsc --noEmit` - PASS (0 errors)
- `bun run lint` - PASS (0 warnings)
- `bunx convex dev --once` - PASS (schema deployed successfully)

**Learnings:**
- Convex automatically appends `_creationTime` to index fields
- Foundation tables (profiles, tags) must be complete before content tables can reference them
- Tags table is simple but critical for cross-content discovery functionality

---

## 2026-01-16 - US-003: Events Table

**Implemented:**
- Defined `events` table in `convex/schema.ts` with all required and optional fields
- Required fields: title, slug, description, date (v.number()), timezone, location, isVirtual (v.boolean()), priceInCents (v.number())
- Optional fields: endDate, agenda, capacity, speakerIds (v.array(v.id("profiles"))), tags (v.array(v.id("tags"))), isFeatured, isArchived
- Created indexes: `by_slug` (URL routing), `by_date` (chronological listing), `by_isFeatured_and_date` (featured events sorted by date)
- Added documentation comments explaining table purpose and field usage

**Files Changed:**
- `convex/schema.ts` - Added events table with all fields and indexes

**Quality Checks:**
- `bunx tsc --noEmit` - PASS (0 errors)
- `bun run lint` - PASS (0 warnings)
- `bunx convex dev --once` - PASS (schema deployed successfully with 3 new indexes)

**Learnings:**
- Events table follows the same pattern as profiles and tags - required/optional field grouping with comments
- speakerIds and tags are arrays of foreign key IDs using v.id() validator
- priceInCents uses v.number() for integer storage (avoiding floating-point currency issues)
- Compound index `by_isFeatured_and_date` enables efficient queries for featured events sorted chronologically

---

## 2026-01-16 - US-004: Profile Role System Validation

**Implemented:**
- Verified `profiles` table has correct role union validator: `admin`, `member`, `guest`
- Verified `profiles` table has correct profileStatus union validator: `locked`, `unlocked`, `published`
- Verified `by_role` index exists for querying profiles by role
- Verified `by_profileStatus` index exists for querying profiles by status
- Verified `socialLinks` nested object supports all required fields: linkedin, twitter, github, website
- Verified `skills` field uses `v.optional(v.array(v.string()))`
- All quality checks pass (TypeScript, ESLint)

**Files Changed:**
- `relentless/features/001-database-schema-core-models/tasks.md` - Updated US-004 status to COMPLETE
- `relentless/features/001-database-schema-core-models/checklist.md` - Marked profile validation items as verified
- `relentless/features/001-database-schema-core-models/progress.txt` - Added this progress entry

**Quality Checks:**
- `bunx tsc --noEmit` - PASS (0 errors)
- `bun run lint` - PASS (0 warnings)

**Learnings:**
- US-004 is a validation story, not an implementation story - the profiles table was fully implemented in US-001
- Profile role system validation confirms schema supports role-based access control patterns
- The foundation work from US-001 already satisfied all US-004 acceptance criteria

---
